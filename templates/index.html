<!DOCTYPE html>
<html>
<head>
    <title>P2P –û–±–º–µ–Ω–Ω–∏–∫</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>üí∞ P2P –û–±–º–µ–Ω–Ω–∏–∫</h1>
        
        <form action="/create_ad" method="post">
            <select name="type" required>
                <option value="buy">–ö—É–ø–∏—Ç—å</option>
                <option value="sell">–ü—Ä–æ–¥–∞—Ç—å</option>
            </select>
            <input type="text" name="asset" placeholder="USDT/BTC" required>
            <input type="number" name="price" placeholder="–¶–µ–Ω–∞" step="0.01" required>
            <input type="number" name="amount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" step="0.0001" required>
            <button type="submit">–°–æ–∑–¥–∞—Ç—å</button>
        </form>

        <div class="ads">
            {% for ad in ads %}
            <div class="ad {{ ad[1] }}">
                <h3>{{ "üü¢ –ö—É–ø–ª—é" if ad[1] == 'buy' else "üî¥ –ü—Ä–æ–¥–∞–º" }} {{ ad[2] }}</h3>
                <p>–¶–µ–Ω–∞: {{ ad[3] }} ‚ÇΩ</p>
                <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ ad[4] }}</p>
                
                {% if ad[1] == 'sell' %}
                <form action="/buy/{{ ad[0] }}" method="post">
                    <button type="submit">–ö—É–ø–∏—Ç—å</button>
                </form>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–∞—Ç–∞ -->
<div id="chatModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="chatMessages" style="height: 300px; overflow-y: scroll;"></div>
        <input type="text" id="messageInput" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
        <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
</div>

<script>
    let currentAdId = 0;
    let socket = null;
    
    // –û—Ç–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞
    function openChat(adId) {
        currentAdId = adId;
        document.getElementById('chatModal').style.display = 'block';
        
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º WebSocket
        socket = new WebSocket(`ws://${window.location.host}/ws/${adId}`);
        
        socket.onmessage = function(event) {
            const messages = document.getElementById('chatMessages');
            messages.innerHTML += `<p>${event.data}</p>`;
            messages.scrollTop = messages.scrollHeight;
        };
    }
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞
    document.querySelector('.close').onclick = function() {
        document.getElementById('chatModal').style.display = 'none';
        if (socket) socket.close();
    }
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    function sendMessage() {
        const input = document.getElementById('messageInput');
        if (socket && input.value) {
            socket.send(input.value);
            input.value = '';
        }
    }
</script>
